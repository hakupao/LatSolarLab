<!DOCTYPE html>
<html lang="zh-CN" id="html-root">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="LatSolar - 计算地球上任意位置在任意日期接收的太阳辐射量">
    <title>LatSolar - 纬度太阳辐射计算器</title>
    <link rel="stylesheet" href="styles.css">

    <!-- 3D地球依赖库 -->
    <script src="https://unpkg.com/three"></script>
    <script src="https://unpkg.com/globe.gl"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>
</head>

<body>
    <!-- 3D地球容器 (背景) -->
    <div id="globe-container"></div>

    <!-- 语言切换按钮 -->
    <div class="top-controls">
        <button id="style-toggle" class="control-btn" title="Switch Globe Style / 切换地球样式">
            <span class="control-icon">🗺️</span>
            <span id="style-text">Texture</span>
        </button>
        <button id="lang-toggle" class="control-btn" title="Switch Language / 切换语言">
            <span class="control-icon">🌐</span>
            <span id="lang-text">English</span>
        </button>
    </div>

    <div class="container">
        <!-- 头部 -->
        <header>
            <div class="header-icon">☀️</div>
            <h1 data-i18n="title">LatSolar</h1>
            <p class="subtitle" data-i18n="description">计算地球上任意位置接收的太阳辐射量</p>
        </header>

        <!-- 输入表单 -->
        <div class="card">
            <h2 class="card-title" data-i18n="inputTitle">📍 输入位置和日期</h2>

            <form id="calculator-form">
                <!-- 模式切换 -->
                <div class="mode-switcher">
                    <div class="mode-option active" data-mode="single" data-i18n="modeSingle">单点计算</div>
                    <div class="mode-option" data-mode="compare-loc" data-i18n="modeCompareLoc">对比地点</div>
                    <div class="mode-option" data-mode="compare-date" data-i18n="modeCompareDate">对比日期</div>
                </div>

                <!-- 位置 1 (主位置) -->
                <div class="input-section" id="location-section-1">
                    <h3 class="section-label" data-i18n="location1Label">📍 地点 1</h3>
                    <!-- 城市搜索 1 -->
                    <div class="city-search-container">
                        <label for="city-search" data-i18n="citySearch">🔍 搜索城市</label>
                        <div class="city-search-wrapper">
                            <input type="text" id="city-search" data-i18n="citySearchPlaceholder"
                                placeholder="输入城市名称 (中文或英文)..." autocomplete="off">
                            <div id="city-suggestions" class="city-suggestions"></div>
                        </div>
                        <small style="color: var(--color-text-muted); margin-top: 0.25rem; display: block;">
                            <span data-i18n="citySearchHint">选择城市后将自动填充坐标</span>
                        </small>
                    </div>

                    <!-- 坐标格式切换和最近城市显示 -->
                    <div class="coordinate-controls">
                        <div class="nearest-city" id="nearest-city-display">
                            <span class="nearest-city-icon">📍</span>
                            <span id="nearest-city-text" data-i18n="nearestCity">输入坐标后显示最近城市</span>
                        </div>
                        <button type="button" id="format-toggle" class="format-toggle" title="切换坐标格式">
                            <span id="format-icon">🔄</span>
                            <span id="format-text" data-i18n="formatToggleToDMS">切换为度分秒</span>
                        </button>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="latitude" data-i18n="latitude">纬度 (°)</label>
                            <input type="number" id="latitude" name="latitude" step="0.0001" min="-90" max="90"
                                data-i18n="latitudePlaceholder" placeholder="例: 35.0" required>
                            <small style="color: var(--color-text-muted); margin-top: 0.25rem;"
                                data-i18n="latitudeHint">
                                范围: -90° (南极) 到 90° (北极)
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="longitude" data-i18n="longitude">经度 (°)</label>
                            <input type="number" id="longitude" name="longitude" step="0.0001" min="-180" max="180"
                                placeholder="例: 139.65" data-i18n="longitudePlaceholder" required>
                            <small style="color: var(--color-text-muted); margin-top: 0.25rem;"
                                data-i18n="longitudeHint">
                                范围: -180° 到 180°
                            </small>
                        </div>
                    </div>
                </div>

                <!-- 位置 2 (对比地点模式显示) -->
                <div class="input-section hidden" id="location-section-2">
                    <h3 class="section-label" data-i18n="location2Label">📍 地点 2 (对比)</h3>
                    <!-- 城市搜索 2 -->
                    <div class="city-search-container">
                        <label for="city-search-2" data-i18n="citySearch">🔍 搜索城市</label>
                        <div class="city-search-wrapper">
                            <input type="text" id="city-search-2" data-i18n="citySearchPlaceholder"
                                placeholder="输入城市名称 (中文或英文)..." autocomplete="off">
                            <div id="city-suggestions-2" class="city-suggestions"></div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="latitude-2" data-i18n="latitude">纬度 (°)</label>
                            <input type="number" id="latitude-2" name="latitude-2" step="0.0001" min="-90" max="90"
                                data-i18n="latitudePlaceholder" placeholder="例: 35.0">
                        </div>

                        <div class="form-group">
                            <label for="longitude-2" data-i18n="longitude">经度 (°)</label>
                            <input type="number" id="longitude-2" name="longitude-2" step="0.0001" min="-180" max="180"
                                placeholder="例: 139.65" data-i18n="longitudePlaceholder">
                        </div>
                    </div>
                </div>

                <!-- 日期 1 (主日期) -->
                <div class="form-grid" id="date-section-1">
                    <div class="form-group">
                        <label for="date" data-i18n="date">日期</label>
                        <input type="date" id="date" name="date" required>
                    </div>
                </div>

                <!-- 日期 2 (对比日期模式显示) -->
                <div class="form-grid hidden" id="date-section-2">
                    <div class="form-group">
                        <label for="date-2" data-i18n="date2Label">日期 2 (对比)</label>
                        <input type="date" id="date-2" name="date-2">
                    </div>
                </div>

                <!-- 错误信息 -->
                <div id="error-message" class="error-message"></div>

                <!-- 计算按钮 -->
                <button type="submit" id="calculate-btn" class="btn btn-primary" data-i18n="calculate">
                    计算
                </button>

                <!-- 快速示例 -->
                <div class="examples">
                    <p class="examples-title" data-i18n="examplesTitle">快速示例:</p>
                    <div class="example-buttons">
                        <button type="button" class="example-btn" data-lat="35.0" data-lon="139.65"
                            data-i18n="exampleYokohama">
                            🗾 横滨 (35°N)
                        </button>
                        <button type="button" class="example-btn" data-lat="0" data-lon="0" data-i18n="exampleEquator">
                            🌍 赤道
                        </button>
                        <button type="button" class="example-btn" data-lat="66.5" data-lon="25.7"
                            data-i18n="exampleArctic">
                            🌌 北极圈
                        </button>
                        <button type="button" class="example-btn" data-lat="-66.5" data-lon="0"
                            data-i18n="exampleAntarctic">
                            🐧 南极圈
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- 结果显示 -->
        <div id="results">
            <div class="card">
                <h2 class="card-title" data-i18n="resultsTitle">📊 计算结果</h2>

                <div class="result-header">
                    <div class="result-location" id="result-location"></div>
                    <div class="result-date" id="result-date"></div>
                </div>

                <div class="results-grid">
                    <div class="result-item">
                        <div class="result-label" data-i18n="dayOfYear">日序数</div>
                        <div class="result-value" id="result-day">-</div>
                    </div>

                    <div class="result-item">
                        <div class="result-label" data-i18n="solarDeclination">太阳赤纬角 (δ)</div>
                        <div class="result-value" id="result-declination">-</div>
                    </div>

                    <div class="result-item">
                        <div class="result-label" data-i18n="daylightHours">日照时长</div>
                        <div class="result-value" id="result-daylight">-</div>
                    </div>

                    <div class="result-item">
                        <div class="result-label" data-i18n="toaRadiation">TOA 日总辐射 (H)</div>
                        <div class="result-value highlight" id="result-toa">-</div>
                    </div>

                    <div class="result-item">
                        <div class="result-label" data-i18n="netAbsorption">净吸收辐射 (F<sub>in</sub>)</div>
                        <div class="result-value highlight" id="result-net">-</div>
                    </div>
                </div>

                <div class="seasonal-hint" id="seasonal-hint"></div>
            </div>
        </div>

        <!-- 公式参考 -->
        <div class="card formula-reference">
            <h3 data-i18n="formulaTitle">📐 计算公式参考</h3>

            <div class="formula-item">
                <strong data-i18n="formulaSolarDeclination">太阳赤纬角:</strong><br>
                <code>δ = 23.45° × sin(360° × (284 + n) / 365)</code>
            </div>

            <div class="formula-item">
                <strong data-i18n="formulaHourAngle">日出/日落时角:</strong><br>
                <code>cos(ω) = -tan(φ) × tan(δ)</code>
            </div>

            <div class="formula-item">
                <strong data-i18n="formulaDaylight">日照时长:</strong><br>
                <code>T = 2ω × 24 / (2π) 小时</code>
            </div>

            <div class="formula-item">
                <strong data-i18n="formulaTOA">日总辐射 (TOA):</strong><br>
                <code>H = (S₀/π) × (1 + 0.033cos(360n/365)) × [ω×sin(φ)sin(δ) + cos(φ)cos(δ)sin(ω)]</code>
            </div>

            <div class="formula-item">
                <strong data-i18n="formulaNetAbsorption">净吸收辐射:</strong><br>
                <code>F<sub>in</sub> = k × H</code> (k ≈ 0.55)
            </div>

            <div
                style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--color-border); color: var(--color-text-muted); font-size: 0.875rem;">
                <p><strong data-i18n="formulaNote">说明:</strong></p>
                <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                    <li data-i18n="formulaNoteItem1">S₀ = 1367 W/m² (太阳常数)</li>
                    <li data-i18n="formulaNoteItem2">φ = 纬度, δ = 赤纬角, ω = 时角, n = 日序数</li>
                    <li data-i18n="formulaNoteItem3">TOA = Top of Atmosphere (大气顶层)</li>
                    <li data-i18n="formulaNoteItem4">k = 有效吸收因子,考虑大气散射、云反射、地表反照率等综合效应</li>
                </ul>
            </div>
        </div>

        <!-- 页脚 -->
        <footer>
            <p data-i18n="footerText">基于简化的能量收支模型 | 数据仅供参考</p>
            <p style="margin-top: 0.5rem; opacity: 0.7;">
                <span data-i18n="footerCopyright">© 2025 LatSolarLab</span>
                <span aria-hidden="true"> · </span>
                <a href="https://github.com/hakupao/LatSolarLab" target="_blank" rel="noopener noreferrer">Project Repository</a>
            </p>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="config.js"></script>
    <script src="i18n.js"></script>
    <script src="cities.js"></script>
    <script src="calculator.js"></script>
    <script src="globe.js"></script>
    <script src="app.js"></script>
</body>

</html>
